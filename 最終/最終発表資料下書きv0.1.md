---
marp: true
math: mathjax
header: "大規模言語モデルによるソフトウェア脆弱性の検出"
paginate: true
style: |
  section{
    font-size: 38px;
  }
  strong {
    color: #F79428;
  }
  em {
    font-style: normal;
    color: #0B3E8D;
    font-weight: bold;
  }
  h1 {
    font-size:48px;
    color: #0B3E8D;
  }
  h2 {
    font-size:48px;
    color: #0B3E8D;
    margin-bottom:-.2em;
  }
  h2 strong {
    font-size:48px;
    color: chocolate;
  }
  h3 {
    font-size:40px;
    color: #0B3E8D;
    margin-top:-.2em;
    margin-bottom:-.1em;
  }
  h3 strong {
    color: chocolate;
  }
  .columns {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 1rem;
  }
  .columns.var {
    display: grid;
    grid-template-columns: var(--ratio) 1fr;
    gap: 1rem;
  }
  .columns.spaced {
    display: grid;
    grid-template-columns: var(--ratio) 10% 1fr;
    gap: 1rem;
  }
  .gray {
    background: whitesmoke;
  }
  .theorem {
    background: whitesmoke;
    padding-top: 0.1em;
    padding-bottom: 0.1em;
    padding-left: 0.4em;
  }
  .statement {
    margin-top: -0.5em;
    padding-left: 0.7em;
  }
  .quote {
    background: whitesmoke;
    margin-left: 5%;
    margin-right: 5%;
    margin-bottom: 3%;
  }
  .quote.white {
    background: white;
  }  .katex .delimcenter,
  .katex .op-symbol {
    display: inline-block;
  }  
  .arrow {
    margin-top: auto;
    margin-bottom: auto;
    margin-left: auto;
    margin-right: auto;
    width: 0; 
    height: 0;   
  }
  .arrow.right {
    border-top: 40px solid transparent;
    border-bottom: 40px solid transparent;
    border-left: 40px solid gray;
  }
  .arrow.down {
    border-left: 40px solid transparent;
    border-right: 40px solid transparent;
    border-top: 40px solid gray;
  }
  .arrow.up {
    border-left: 40px solid transparent;
    border-right: 40px solid transparent;
    border-bottom: 40px solid gray;
  }
  .center {
    margin-right: auto;
    margin-left: auto;
    text-align: center; 
        font-size: 28px;
  }
  .middle {
    margin-top: auto;
    margin-bottom: auto;
  }
  .large {
    font-size: 28pt;
  }
  .hline {
    margin-top:20px;
    margin-bottom:20px;
    margin-left: 0%;
    margin-right: 0%;
    width: 1fr; 
    height: 0;   
    border-top: 2px solid gray;
  }
  .vline {
    margin-top:0%;
    margin-bottom:0%;
    margin-left: 20px;
    margin-right: 20px;
    width: 0; 
    height: 1fr;   
    border-left: 2px solid gray;
  }
  .shade {
    width: 1fr;
    background: white;
    opacity: 0.7;   
  }
  .white {
    width: 1fr;
    background: white;
  }
  .split{
    display: table;
  }
  .split-item {
    display: table-cell;
    padding: 0px;
  }
  .split-left {
    position: fixed;
  }
  .split-midRight {
    position: fixed;
    right: 12.5%;
  }
  .split-right {
    position: fixed;
    right: 0;
  }
---
<!-- 全体の流れを見直す必要あり？ -->

# 大規模言語モデルによるソフトウェア脆弱性の検出

#### 高知大学 理工学部情報科学科 B4
#### 横川武典

---

## 1. 研究背景
<!-- Webアプリの現状について書く -->

言語モデルを用いたコーディングが普及
$\rightarrow$セキュリティに関する指示をしない場合**脆弱なコードが生成**

![](./AI_CodingTools.png)
<div class='center'>図1. コーディングに使われる言語モデルが含まれるツールの例</div>

--- 

Webアプリケーションは公開範囲が広い
$\rightarrow$開発者自身が**脆弱性に気づかないまま公開**
　 $\rightarrow$**コードの安全性**の担保が課題

<br/>

**言語モデル**を脆弱性検出に活用
$\rightarrow$ **文脈**を考慮可能
　 $\rightarrow$ルールベースでは発見の難しい脆弱性も検出可能

--- 

一方で、以下の問題も存在
- **誤検知** 
- **検出漏れ** 

$\rightarrow$ 言語モデルの使い方次第で検出性能が変化
　 $\rightarrow$ 利用方法の違いが脆弱性検出に与える影響の整理は不十分

--- 

## 2. 研究目的
言語モデルで脆弱性を**自動で検知**する際、
**モデルの利用方法の違い**が検出に与える影響を調べる

以下の3種類で脆弱性検出を行い、**精度**/**安定性**を評価
- 素の言語モデル
- **FineTuning**を行った言語モデル
- **RAG**を利用した言語モデル

---

## 3. 既存手法
**従来の脆弱性検出手法**は大きく2つに分けられる
<div class="split">
  <div class=" split-left">
    <h3>静的解析</h3>
    <ul>
      <li>実行せずにコードを解析</li>
      <li>ルールベース中心 </li>
      <li><strong>誤検知が多い</strong></li>
    </ul>
  </div>
  <div class="split-midRight">
    <h3>動的解析</h3>
    <ul>
      <li>実行時の挙動を解析</li>
      <li>実環境に近い検出</li>
      <li><strong>検出漏れが発生しやすい</strong></li>
    </ul>
  </div>
</div>

<br/><br/><br/><br/>

$\rightarrow$ 既存手法では**コード全体の文脈**を考慮した検出が困難
　 $\rightarrow$ **文脈理解**による検出手法として**言語モデルの活用**が期待

---

<!-- LLMがセキュリティ分野においてどう使われているかを書く -->
### セキュリティ分野での言語モデルの活用
言語モデルは**セキュリティ関連タスク**に既に活用

- **脆弱性の説明・要約**
  - 脆弱性レポートやアラートの理解支援
- **脆弱性検出**
  - コードの文脈を考慮した指摘が可能

$\rightarrow$ **言語モデルの出力の信頼性**が重要
　 特に脆弱性検出では**誤検知・検出漏れが実運用に影響**

--- 

<!-- github copilotは脆弱性が修正可能と謳っている -->
<!-- https://docs.github.com/ja/copilot/tutorials/copilot-chat-cookbook/analyze-security/find-vulnerabilities -->

<!-- LLMを使ったソフトウェアの脆弱性検出手法の調査 -->
<!-- https://arxiv.org/html/2502.07049v2 -->

## 4. 関連研究
#### LLMs in Software Security: A Survey of Vulnerability Detection Techniques and Insights [Ze Sheng+2025]


- **コードの断片**から脆弱性を検出できる言語モデルが存在
- **リポジトリ**単位では限定的な脆弱性の検出のみ可能
- メモリ関連の脆弱性は検出精度が高い
- C/C++に関する研究が多い

$\rightarrow$ 既存研究は主に **C/C++** が中心
　 **Web言語**を対象に**LLMの利用方法の違い**に着目して評価

---

## 5. 提案手法
<!-- 全体の概要 -->
<!-- 全体構成の図が欲しい -->
脆弱性のデータベースを**参照**/**学習**に利用
$\rightarrow$ 脆弱性の発見精度を改善

1. 脆弱性のデータベースを取得/作成
2. データベースを元に**RAG**の作成/**FineTuning**
3. 各モデルでソースコードから脆弱性を探す

---

### RAG(Retrieval-Augmented Generation)とは
<!-- RAGについて -->
<!-- 図を修正 -->
RAGは**事前学習していない外部知識を検索しその情報に基づいて文章を生成する手法**

<div class="split">
  <div class="split-item split-left">
    以下の3段階で機能<br/>
    1. クエリと<strong>類似する情報</strong>を<br/>
    　データベースから検索<br/>
    2. <strong>得られた情報</strong>をプロンプトに追加<br/>
    3. LLMにプロンプトを入力して推論<br/>
  </div>
  <div class="split-item split-right">
    <img src="./rag_img.png">
  </div>
</div> <br/><br/><br/><br/><br/>

$\rightarrow$ 最新の**脆弱性知識**を柔軟に反映

---

### FineTuningとは
<!-- FTについて -->
<!-- 図があるとよい？ -->
既存の学習済みモデルに**追加の学習を行い特定のタスク用に
調整する**手法
<div class="split">
  <div class="split-item split-left">
    メリットは以下の3つ<br/>
    1. <strong>コストが安い</strong><br/>
    2. 最新の情報への対応<br/>
    3. 特定用途に<strong>特化したモデル</strong><br/>
    　を作成可<br/>
  </div>
  <div class="split-item split-right">
    <img src="./ft_img.png">
  </div>
</div> <br/><br/><br/><br/><br/>

$\rightarrow$ **脆弱性検出タスク**への適応

---

## 6. 実験設定
1. 脆弱性の**データベースを取得/作成**
$\rightarrow$ 脆弱性データ数: 19800件
　 脆弱性のある記述例: 750件
2. データベースを元に**RAGの作成/FineTuning**
3. ソースコードから**脆弱性を探す**
$\rightarrow$ LLMが生成したソースコード: 10件

---

## 7. 評価方法
脆弱性の検出結果を**指標**として数値化

- 対象 : PHPで記述されたWebアプリケーション
- 比較対象 : 素のLLM 　 　　　　　　(以下**Base**)
 　 　 　 　FineTuningを行ったLLM (以下**FT**)
 　 　 　 　RAGを接続したLLM 　 　(以下**RAG**)
  - 各構成に同一コードを入力し、脆弱性の検出結果を取得
- 評価指標 : **Precision** / **Recall** / **F1-score** / **AUC**
 ※ AUC : **閾値に依存しない**検出性能指標

---

<div class="split">
  <div class="split-item split-left">
    <h2>8. 実験結果</h2>
    図4より、F1-scoreは<br/>
    <ul>
      <li><strong>FT</strong>が最も正しく検出</li>
      <li><strong>RAG</strong>は<strong>Base</strong>より悪化</li>
    </ul>
  </div>
  <div class="split-item split-right">
    <img src="./F1-score.png">
    <div class='center'>図4. F1-scoreの測定結果</div>
  </div>
</div> <br/><br/><br/><br/><br/><br/>



<br/><br/><br/>

---

<div class="split">
  <div class="split-item split-left">
    <h2>8. 実験結果</h2>
    図5より、AUCは<br/>
    <ul>
      <li><strong>FT</strong>が最も検出性能が高い</li>
      <li>次点で<strong>RAG</strong>が高い</li>
    </ul>
  </div>
  <div class="split-item split-right">
    <img src="./AUC.png">
    <div class='center'>図5. AUCの測定結果</div>
  </div>
</div> <br/><br/><br/><br/><br/><br/>

次に、結果が生じた要因を
**誤検知（FP）・検出漏れ（FN）**
から分析する

<br/><br/><br/>

---

### 誤検知(FP)の傾向
**Base** において多く発生、**RAG** でも一定数発生
- Baseでは文脈理解が不十分で脆弱性を**過剰**に指摘
- RAGでは**関連知識の誤適用**/**コンテキスト長の増加**が存在

**XSS** を検出するタスクで多く発生
- 過剰に出力をエスケープ
 $\rightarrow$ **文脈を理解した検出**は不十分

---

### 検出漏れ(FN)の傾向
**Base** において多く発生
-  文脈理解が不十分なまま安全側に判断

**FT / RAG** では脆弱性知識の獲得により改善
- ただし完全には解消されず

---

## 9. 結論

LLMはWebアプリケーションの脆弱性検出に**活用可能**
ただし**利用方法により検出性能は大きく異なる**

- FTは**検出精度の安定化**に有効
- RAGは**知識依存度の高い脆弱性**で効果を示した

$\rightarrow$ 利用方法の違いが検出性能に影響することを確認

---

## 10. 今後の課題
- より大規模・多様なコードでの検証
- 脆弱性検出結果の**根拠や判断理由の可視化**
- 誤検知パターンの**体系的分析**

---

## 参考文献

- [Ze Sheng+2025] LLMs in Software Security: A Survey of Vulnerability Detection Techniques and Insights\
 https://arxiv.org/html/2502.07049v2

- JVN iPedia - 脆弱性対策情報データベース\
 https://jvndb.jvn.jp/

- CVE: Common Vulnerabilities and Exposures\
 https://www.cve.org/CVERecord

---

## Appendix A. WEB言語の脆弱性の傾向

2022年に脆弱性が悪用された技術としてWordPressがトップ
全体の1/4を占めた

<div class="center">
<img src="./linux-threat-landscape-figure.jpg">
</div>

--- 

<!-- RAG -->
<!-- https://qiita.com/yagiyanagi/items/bfff61dbd077eb391812 -->

<!-- FineTuning -->
<!-- https://www.codemajin.net/fine-tuning-llm-with-unsloth/ -->

## Appendix B. データベースの活用方法

### FineTuningの場合
OSSの言語モデルに脆弱性のデータベースで**追加学習**
この処理は"unsloth", "trl"等のライブラリを使用

### RAGを作成する場合
**自然言語**で書かれた脆弱性のデータベースを**ベクトル**に変換
この処理は"LangChain", "LanceDB"等のライブラリを使用
ベクトル化には"infloat_multilingual-e5-large"を使用

